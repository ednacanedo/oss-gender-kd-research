---
title: "rq2"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(fig.width=5, fig.height=5, fig.path='figures/', dev=c('png', 'pdf'))
require(quanteda)
require(sqldf)
require(readtext)
require(wordcloud)
require(xtable)
require(plotrix)
require(gdata)
require(lattice)
require(Hmisc)
require(reshape2)
setwd(".")
```

## How do the contributions of women key developers compare to the contributions of men key developers

To answer RQ1, we use two datasets. 

   * f_commits_ds: contains information about female contributions in terms of commits
   * m_commits_ds: contains information about male contributions in terms of commits 
   
```{r cars}
f_commits_ds <- read.csv("../datasets/commits_female_categorized.csv", head=T, sep=";")
colnames(f_commits_ds)
nrow(f_commits_ds)

f_commits_ds["commit_date"] <- as.character(as.Date(strptime((f_commits_ds$last_modified), "%a, %d %b %Y %H:%M:%S")))
f_commits_ds$gender <- "female"

m_commits_ds <- read.csv("../datasets/commits_male_categorized.csv", head=T, sep=";")
colnames(m_commits_ds)
nrow(m_commits_ds)

m_commits_ds["commit_date"] <- as.character(as.Date(strptime((m_commits_ds$last_modified), "%a, %d %b %Y %H:%M:%S")))
m_commits_ds$gender <- "male"

commits_ds <- rbind(f_commits_ds, m_commits_ds)

colnames(commits_ds)
nrow(commits_ds)
sqldf("select count (distinct(commit_date)) from commits_ds")
head(commits_ds[,c("commit_date", "last_modified")])


sqldf("select count(distinct login) from f_commits_ds")

sqldf("select count(distinct login) from m_commits_ds")
```


# Summarizing our dataset 

```{r boxplot1,fig.width=5, fig.height = 3.5}
commits_by_user <- sqldf("select login, gender, 
                                 count(distinct hash_commit) commits,
                                 max(commit_date) max_date, 
                                 min(commit_date) min_date, 
                                 count(distinct commit_date) frequency, 
                                 sum(num_files) files ,
                                 sum(num_files_changed) files_changed,
                                 sum(num_files_deleted) files_deleted,
                                 sum(num_files_added) files_added,
                                 sum(num_files_renamed) files_renamed,
                                 sum(num_lines_changed) lines_changed,
                                 sum(num_lines_deleted) lines_deleted,
                                 sum(num_lines_added) lines_added
                          from commits_ds
                          group by login, gender")
                          

colnames(commits_by_user)
nrow(commits_by_user)
commits_by_user$gender <- gsub("male", "Male", commits_by_user$gender)
commits_by_user$gender <- gsub("feMale", "Female", commits_by_user$gender)

bwplot(commits_by_user$commits~commits_by_user$gender, ylab="Total number of contributions (commits)",
     scales=list(x=list(labels=c("WKD","MKD"))))

wilcox.test(commits_by_user$commits~commits_by_user$gender)

```


```{r bw-frequency,fig.width=5, fig.height = 3.5}
commits_by_user["date_diff"] = as.numeric(difftime(as.Date(commits_by_user$max_date), as.Date(commits_by_user$min_date), units="days"))
commits_by_user["frequency2"] = 100*commits_by_user$frequency / commits_by_user$date_diff 
bwplot(commits_by_user$frequency~commits_by_user$gender, ylab="Frequency of commits")
head(commits_by_user[,c("max_date", "min_date", "date_diff", "frequency", "frequency2", "commits")])
cor.test(commits_by_user$frequency2, commits_by_user$commits, method="spearman")
bwplot(commits_by_user$frequency2~commits_by_user$gender, ylab="Frequency of commits",scales=list(x=list(labels=c("WKD","MKD"))))

wilcox.test(commits_by_user$frequency2~commits_by_user$gender)


summary(commits_by_user[commits_by_user$gender == 'Female',]$frequency2)
summary(commits_by_user[commits_by_user$gender == 'Male',]$frequency2)

```

# Size of the contribution

   * considering lines of code

```{r bw-size,fig.width=5, fig.height = 3.5} 
lines <- commits_by_user[,c("login", "gender", "lines_added", "lines_changed", "lines_deleted")]

lines <- melt(lines, id.vars = c("login", "gender"))

lines <- lines[order(lines$variable),]

lines$variable <- gsub("lines_added", "Lines Added", lines$variable)
lines$variable <- gsub("lines_changed", "Lines Changed", lines$variable)
lines$variable <- gsub("lines_deleted", "Lines Deleted", lines$variable)


bwplot(log(value)~gender|variable, data=lines,ylab="Lines of Code (log scale)",layout=c(3,1), scales=list(x=list(labels=c("WKD","MKD"))))

ld <- lines[lines$variable == "Lines Deleted", ]
head(ld)
shapiro.test(ld$value)
wilcox.test(ld$value~ld$gender)
```


   * considering lines of code

```{r} 
files <- commits_by_user[,c("login", "gender", "files_added", "files_changed", "files_deleted")]

files <- melt(files, id.vars = c("login", "gender"))

files <- files[order(files$variable),]

files$variable <- gsub("files_added", "Files Added", files$variable)
files$variable <- gsub("files_changed", "Files Changed", files$variable)
files$variable <- gsub("files_deleted", "Files Deleted", files$variable)


bwplot(log(value)~gender|variable, data=files,ylab="Number of Files (Log Scale)",layout=c(3,1), scales=list(x=list(labels=c("WKD","MKD"))))
```

# Type of the contributions 

```{r bw-contribution, fig.width=8, fig.height = 3.5}
commits_ds["comment_size"] = nchar(as.character(commits_ds$message))

boxplot(log(commits_ds$comment_size)~commits_ds$gender)

wilcox.test(commits_ds$comment_size~commits_ds$gender)

summary(commits_ds[commits_ds$gender == 'female',]$comment_size)
summary(commits_ds[commits_ds$gender == 'male',]$comment_size)


contributions_ds <- sqldf("select login, gender, class, count(*) total
                           from commits_ds 
                           group by login, gender, class")


bwplot(log(total)~gender|class, data=contributions_ds, par.strip.text=list(cex=0.75),layout=c(5,1), scales=list(x=list(labels=c("WKD","MKD"))))

chisq.test(commits_ds$class, commits_ds$gender)
```

There is a huge difference in the number of commits. Perhaps we should first balance the dataset. 

```{r bw-balanced-contribution, fig.width=8, fig.height = 3.5}
m_commits_ds <- m_commits_ds[sample(nrow(m_commits_ds), 22326, replace = FALSE, prob = NULL),]

nrow(f_commits_ds)
nrow(m_commits_ds)

commits_ds <- rbind(f_commits_ds, m_commits_ds)

contributions_ds <- sqldf("select login, gender, class, count(*) total
                           from commits_ds 
                           group by login, gender, class")


bwplot(log(total)~gender|class, data=contributions_ds, par.strip.text=list(cex=0.75),layout=c(5,1), scales=list(x=list(labels=c("WKD","MKD"))))

chisq.test(commits_ds$class, commits_ds$gender)
```
